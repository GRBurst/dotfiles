#!/run/current-system/sw/bin/zsh -ie

# System related
echo "upgrading installed packages..."
sudo nixos-rebuild switch --upgrade

echo "cleanup nix garbage"
nix-collect-garbage --delete-older-than 30d

echo "optimize nix-store"
nix-store --optimize

# Local packages
nix-env -iA highres-packages -f '<nixpkgs>'

# Plugin manager and programs
echo "updating zgen plugins..."
zgen update

echo "updating vim plugins..."
vim +PlugUpgrade +PlugInstall +PlugUpdate +PlugClean! +qall

# echo "updating global npm packages"
# npm -g update

# echo "updating git repos"
# mr update

# Filesystem related
echo "updating mlocate database..."
sudo updatedb
sudo mandb

# sudo btrfs filesystem defragment /
sync

exit 0
