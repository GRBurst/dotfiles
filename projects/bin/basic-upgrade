#!/run/current-system/sw/bin/zsh -i

self () {
    set -e

    case "${1}" in
        system)
            # System updates
            system-upgrade
            echo "finished system upgrade"
        ;&
        userpkgs)
            # Local packages upgrade
            userpkgs-upgrade

            # Local packages cleanup
            userpkgs-cleanup
            echo "finished userpkgs upgrade"
        ;&
        usertools)
            # Plugin manager and programs
            usertools-upgrade

            # cecho "G" "updating global npm packages"
            # npm -g update

            # cecho "G" "updating git repos"
            # mr update
            echo "finished usertools upgrade"
        ;&
        filesystem)
            # Filesystem related
            filesystem-upgrade
            echo "finished filesystem upgrade"
        ;;
        *)
            echo "unknown parameter ${1}, expected one of:"
            echo "\tsystem"
            echo "\tuserpkgs"
            echo "\tusertools"
            echo "\tfilesystem"
            exit 1
    esac

    exit 0

}

echo "Running self ${1:=system}"

self "$@"

exit 0
